{# templates/base.html #}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{{ request.user.username }} Insight{% endblock %}</title>

    <!-- Tailwind CDN (fine for dev/learning) -->
    <script src="https://cdn.tailwindcss.com"></script>

    {% block extra_head %}{% endblock %}
  </head>

  <!-- Full-height flex layout so footer sits at bottom -->
  <body class="min-h-screen flex flex-col bg-gray-50 text-gray-900">

    <!-- ===== Top Navigation (responsive) ===== -->
    <header class="bg-white border-b sticky top-0 z-10">
      <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
        <!-- Brand -->
        <a href="{% url 'accounts:home' %}" class="font-semibold text-lg">{{ request.user.username }} Insight</a>

        <!-- Mobile menu toggle -->
        <button id="nav-toggle"
                class="sm:hidden inline-flex items-center justify-center rounded-md p-2 border hover:bg-gray-50"
                aria-label="Toggle navigation" aria-expanded="false">
          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M3 5h14v2H3V5zm0 4h14v2H3V9zm0 4h14v2H3v-2z" clip-rule="evenodd"/>
          </svg>
        </button>

        <!-- Desktop nav -->
        {% with current=request.resolver_match.url_name %}
        <nav class="hidden sm:flex items-center gap-4">
          {% if request.user.is_authenticated %}
            <a href="{% url 'accounts:home' %}"
               class="{% if current == 'home' %}text-indigo-600 font-medium{% else %}text-gray-600 hover:text-indigo-600{% endif %} text-sm">
              Home
            </a>
            <a href="{% url 'finance:dashboard' %}"
               class="{% if current == 'dashboard' %}text-indigo-600 font-medium{% else %}text-gray-600 hover:text-indigo-600{% endif %} text-sm">
              Dashboard
            </a>
            <a href="{% url 'finance:transaction_list' %}"
               class="{% if current == 'transaction_list' %}text-indigo-600 font-medium{% else %}text-gray-600 hover:text-indigo-600{% endif %} text-sm">
              Transactions
            </a>
            <a href="{% url 'finance:category_list' %}"
               class="{% if current == 'category_list' %}text-indigo-600 font-medium{% else %}text-gray-600 hover:text-indigo-600{% endif %} text-sm">
              Categories
            </a>
            <a href="{% url 'finance:pl_report' %}"
               class="{% if current == 'pl_report' %}text-indigo-600 font-medium{% else %}text-gray-600 hover:text-indigo-600{% endif %} text-sm">
              Reports
            </a>

            <!-- Logout as POST (fixes 405) -->
            <form action="{% url 'accounts:logout' %}" method="post" class="inline">
              {% csrf_token %}
              <button type="submit" class="text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded">
                Logout
              </button>
            </form>
          {% else %}
            <a href="{% url 'accounts:login' %}" class="text-sm hover:text-indigo-600">Login</a>
            <a href="{% url 'accounts:signup' %}"
               class="text-sm bg-indigo-600 text-white px-3 py-1.5 rounded hover:bg-indigo-700">
              Sign up
            </a>
          {% endif %}
        </nav>
        {% endwith %}
      </div>

      <!-- Mobile dropdown -->
      {% with current=request.resolver_match.url_name %}
      <nav id="nav-menu" class="sm:hidden hidden border-t">
        <div class="max-w-5xl mx-auto px-4 py-3 space-y-2">
          {% if request.user.is_authenticated %}
            <a href="{% url 'accounts:home' %}"
               class="block text-sm {% if current == 'home' %}text-indigo-600 font-medium{% else %}text-gray-700{% endif %}">
              Home
            </a>
            <a href="{% url 'finance:dashboard' %}"
               class="block text-sm {% if current == 'dashboard' %}text-indigo-600 font-medium{% else %}text-gray-700{% endif %}">
              Dashboard
            </a>
            <a href="{% url 'finance:transaction_list' %}"
               class="block text-sm {% if current == 'transaction_list' %}text-indigo-600 font-medium{% else %}text-gray-700{% endif %}">
              Transactions
            </a>
            <a href="{% url 'finance:category_list' %}"
               class="block text-sm {% if current == 'category_list' %}text-indigo-600 font-medium{% else %}text-gray-700{% endif %}">
              Categories
            </a>
            <a href="{% url 'finance:pl_report' %}"
               class="block text-sm {% if current == 'pl_report' %}text-indigo-600 font-medium{% else %}text-gray-700{% endif %}">
              Reports
            </a>
            <!-- Mobile logout as POST -->
            <form action="{% url 'accounts:logout' %}" method="post" class="inline-block mt-2">
              {% csrf_token %}
              <button type="submit" class="text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded">
                Logout
              </button>
            </form>
          {% else %}
            <a href="{% url 'accounts:login' %}" class="block text-sm">Login</a>
            <a href="{% url 'accounts:signup' %}"
               class="inline-flex mt-2 text-sm bg-indigo-600 text-white px-3 py-1.5 rounded hover:bg-indigo-700">
              Sign up
            </a>
          {% endif %}
        </div>
      </nav>
      {% endwith %}
    </header>
    <!-- ===== /Top Navigation ===== -->

    <!-- Flash messages -->
    <div class="max-w-5xl mx-auto px-4 mt-4 space-y-2 w-full">
      {% if messages %}
        {% for message in messages %}
          <div
            class="rounded px-4 py-3 text-sm
                   {% if message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200
                   {% elif message.tags == 'warning' %}bg-yellow-50 text-yellow-800 border border-yellow-200
                   {% elif message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200
                   {% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    </div>

    <!-- Main content -->
    <main class="flex-1 max-w-5xl mx-auto px-4 py-6 w-full">
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="mt-auto border-t py-6 text-center text-xs text-gray-500">
      © {% now "Y" %} Mo4_Tv Money Tracker • Built for Financial Clarity
    </footer>

    <!-- Small helpers: style plain inputs/buttons and toggle mobile nav -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Style basic inputs/selects/textarea if they don't already have rounded-md
        const baseInput =
          "mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 " +
          "focus:outline-none focus:ring focus:ring-indigo-200 focus:border-indigo-500 text-sm";

        document.querySelectorAll('input[type=text], input[type=password], input[type=email], input[type=number], input[type=date], select, textarea')
          .forEach(el => {
            if (!el.className.includes('rounded-md')) {
              el.className = (el.className + " " + baseInput).trim();
            }
          });

        // Style buttons if they don't already have a Tailwind bg-* class
        document.querySelectorAll('button, [type=submit]').forEach(btn => {
          if (!/bg-(indigo|gray|red|green|blue|yellow|emerald)/.test(btn.className)) {
            btn.className = (btn.className + " inline-flex items-center justify-center " +
                             "bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 text-sm").trim();
          }
        });

        // Mobile nav toggle
        const toggle = document.getElementById('nav-toggle');
        const menu = document.getElementById('nav-menu');
        if (toggle && menu) {
          toggle.addEventListener('click', () => {
            const isHidden = menu.classList.contains('hidden');
            menu.classList.toggle('hidden', !isHidden);
            toggle.setAttribute('aria-expanded', String(isHidden));
          });
        }
      });
    </script>

    {% block extra_scripts %}{% endblock %}
  </body>
</html>
