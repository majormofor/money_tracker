{% extends "base.html" %} <!-- âœ… reuse layout -->
{% block title %}Transactions â€¢ Mofor P&L{% endblock %}

{% block content %}
  <!-- Header + Add button -->
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-xl font-semibold">Transactions</h1>

     <a href="{% url 'accounts:currency_settings' %}" class="bg-indigo-600 text-white px-3 py-2 rounded hover:bg-green-700 text-sm">
      
      <span aria-hidden="true">ðŸ’±</span>  <!-- ðŸª™ visual icon only (hidden from screen readers) -->
  Change Currency
    </a>
    <a href="{% url 'finance:transaction_create' %}" class="bg-indigo-600 text-white px-3 py-2 rounded hover:bg-indigo-700 text-sm">
      + Add transaction
    </a>
  
  </div>

  <!-- KPI cards -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
    <div class="bg-white border rounded-xl p-4">
      <div class="text-xs text-gray-500">Total Income</div>
      <!-- ðŸ’± Use the selected currency; fallback to Â£ if not provided -->
      <div class="text-lg font-semibold text-emerald-700 mt-1">{{ currency|default:"Â£" }}{{ total_income|floatformat:2 }}</div>
    </div>
    <div class="bg-white border rounded-xl p-4">
      <div class="text-xs text-gray-500">Total Expense</div>
      <!-- ðŸ’± Use the selected currency -->
      <div class="text-lg font-semibold text-rose-700 mt-1">{{ currency|default:"Â£" }}{{ total_expense|floatformat:2 }}</div>
    </div>
    <div class="bg-white border rounded-xl p-4">
      <div class="text-xs text-gray-500">Net</div>
      <!-- ðŸ’± Use the selected currency; green for â‰¥0, red for <0 -->
      <div class="text-lg font-semibold mt-1 {% if net >= 0 %}text-emerald-700{% else %}text-rose-700{% endif %}">
        {{ currency|default:"Â£" }}{{ net|floatformat:2 }}
      </div>
    </div>
  </div>

  <!-- Filters -->
  <form method="get" class="bg-white border rounded-xl p-4 mb-4 grid grid-cols-1 md:grid-cols-5 gap-3">
    <!-- Type -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Type</label>
      <select name="type" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm">
        <option value="Both" {% if filters.type == "Both" %}selected{% endif %}>Both</option>
        <option value="Income" {% if filters.type == "Income" %}selected{% endif %}>Income</option>
        <option value="Expense" {% if filters.type == "Expense" %}selected{% endif %}>Expense</option>
      </select>
    </div>

    <!-- Category -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Category</label>
      <select name="category" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm">
        <option value="">All</option>
        {% for c in all_categories %}
          <option value="{{ c.id }}" {% if filters.category|add:'' == c.id|stringformat:"s" %}selected{% endif %}>
            {{ c.type }} â€” {{ c.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Date from -->
    <div>
      <label class="block text-sm font-medium text-gray-700">From</label>
      <input type="date" name="date_from" value="{{ filters.date_from }}"
             class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm" />
    </div>

    <!-- Date to -->
    <div>
      <label class="block text-sm font-medium text-gray-700">To</label>
      <input type="date" name="date_to" value="{{ filters.date_to }}"
             class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm" />
    </div>

    <!-- Search -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Search</label>
      <input type="text" name="q" value="{{ filters.q }}" placeholder="title or notesâ€¦"
             class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm" />
    </div>

    <!-- Actions -->
    <div class="md:col-span-5 flex items-center justify-end gap-2">
      <a href="{% url 'finance:transaction_list' %}" class="px-3 py-2 rounded bg-gray-100 hover:bg-gray-200 text-sm">Clear</a>
      <button type="submit">Apply</button>
    </div>
  </form>

  <!-- Table -->
  <div class="bg-white border rounded-xl overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-50 text-gray-600">
        <tr>
          <th class="text-left px-4 py-3">Date</th>
          <th class="text-left px-4 py-3">Title</th>
          <th class="text-left px-4 py-3">Type</th>
          <th class="text-left px-4 py-3">Category</th>
          <th class="text-right px-4 py-3">Amount</th>
          <th class="text-right px-4 py-3">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y">
        {% for t in transactions %}
          <tr>
            <td class="px-4 py-3 whitespace-nowrap">{{ t.date|date:"Y-m-d" }}</td>
            <td class="px-4 py-3">{{ t.title }}</td>
            <td class="px-4 py-3">
              <span class="px-2 py-0.5 rounded text-xs
                {% if t.transaction_type == 'Income' %}bg-emerald-50 text-emerald-700 border border-emerald-200
                {% else %}bg-rose-50 text-rose-700 border border-rose-200{% endif %}">
                {{ t.transaction_type }}
              </span>
            </td>
            <td class="px-4 py-3">{{ t.category.name }}</td>
            <td class="px-4 py-3 text-right font-medium
                {% if t.transaction_type == 'Income' %}text-emerald-700{% else %}text-rose-700{% endif %}">
              <!-- ðŸ’± Use the selected currency for each row amount -->
              {{ currency|default:"Â£" }}{{ t.amount|floatformat:2 }}
            </td>
            <td class="px-4 py-3 text-right whitespace-nowrap">
              <!-- âš ï¸ If your URL name is 'transaction_update', use that instead of 'transaction_edit' -->
              <a href="{% url 'finance:transaction_update' t.pk %}" class="text-sm px-3 py-1.5 rounded bg-gray-100 hover:bg-gray-200">Edit</a>
              <a href="{% url 'finance:transaction_delete' t.pk %}" class="text-sm px-3 py-1.5 rounded bg-red-50 text-red-700 hover:bg-red-100">Delete</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="px-4 py-6 text-center text-gray-500">No transactions match your filters.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination (only shows if there are multiple pages) -->
  {% if is_paginated %}
    <div class="flex items-center justify-between mt-4 text-sm">
      <div>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</div>
      <div class="space-x-2">
        {% if page_obj.has_previous %}
          <a class="px-3 py-1 rounded bg-gray-100 hover:bg-gray-200"
             href="?page={{ page_obj.previous_page_number }}&type={{ filters.type }}&category={{ filters.category }}&date_from={{ filters.date_from }}&date_to={{ filters.date_to }}&q={{ filters.q }}">Prev</a>
        {% endif %}
        {% if page_obj.has_next %}
          <a class="px-3 py-1 rounded bg-gray-100 hover:bg-gray-200"
             href="?page={{ page_obj.next_page_number }}&type={{ filters.type }}&category={{ filters.category }}&date_from={{ filters.date_from }}&date_to={{ filters.date_to }}&q={{ filters.q }}">Next</a>
        {% endif %}
      </div>
    </div>
  {% endif %}
{% endblock %}
